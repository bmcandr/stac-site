# Stac Website

This is the repo for [stacspec.org](https://stacspec.org).

The website is built using the [Node.js](https://nodejs.org/en/) based [static site generator 11ty](https://www.11ty.dev/).

Tutorials are created using markdown and jupyter notebooks, and the page templates are written with [Nunjucks](https://mozilla.github.io/nunjucks/).

## Getting Started

### Prereqs
- [Node & NPM](https://nodejs.org/en/) 
    - Recommended [mac installation with homebrew & nvm](https://formulae.brew.sh/formula/nvm)
    - Recommended pc installation with [chocolatey & nvm](https://community.chocolatey.org/packages/nvm)
    - [nvm documentation](https://github.com/nvm-sh/nvm#readme)
- [Docker](https://www.docker.com/products/docker-desktop/) (If adding Jupyter Notebooks)

### Installation

```
npm install
npm run serve
```

If this step results in errors, I recommend using node version `17.8.0`, the current stable version at the time of writing.

## Creating Tutorials

New tutorials are created in markdown format and added in to the [app/tutorials] directory.

Tutorials are categorized by adding them to a directory in the tutorials folder.

Tutorials should be in their own directory along with any translated versions of the tutorial.

Heres an example:

```
app/
    tutorials/                           # this is the tutorials root
        getting-started/                 # this is the category
            stac-collections/            # this is the tutorial
                stac-collections.en.md   # this is an english version
                stac-colecciones.es.md   # this is a spanish version
```

The url paths are autogenerated, for the tutorials shown above they would be:

```
/en/tutorials/stac-collections
/es/tutorials/stac-collecciones
```

### Tutorial Frontmatter Requirements

You'll need to add a few properties in `yml` format to the markdown frontmatter at the very top of your file. Here's an example:

```
---
title: A title for your tutorial, this is used for SEO and in previews throughout the site
description: A short description of the tutorial. This will be used in the meta description and in tutorial previews throughout the site.
notebooks:
    - name-of-notebook-file-no-extension
---
```

the notebooks property is optional, and will add a notebook from the [notebooks/build](./notebooks/build) directory below any markdown content you add to the tutorial.

### Compiling Notebooks

Add notebooks to the [notebooks/src](./notebooks/src) directory

Notebooks can be built via [python 3.9](https://github.com/docker-library/python/blob/e3f954f284ab822e939d99bddb3bfb25574f585e/3.9/slim-bullseye/Dockerfile) with the included docker-compose config by running:

```
docker-compose up
```

Docker is the more consistent way to compile the notebooks, but you may also run the bash build script directly if you have python 3.x installed on your machine:

```
cd notebooks
pip3 install -r requirements.txt
sh build_notebooks
```

## Creating Pages

If you want to create a new page, here are the steps you'll follow

1. Create a `.html` file for your page template in the `app/pages` directory.
1. Create a content file in the `content` directory, and be sure to require that file in the parent content file (for a new "about" page, include it at the bottom of the content/about/index.js file. For a new base level page, you'd include it in the `content/index.js` file.
1. Link the template file with the content file by adding a `name` to the template frontmatter (see [Page Frontmatter Requirements](#page-frontmatter-requirements) below)
1. Add a route to the page for each translation (Also see [Page Frontmatter Requirements](#page-frontmatter-requirements) below)
1. Now you're ready to create your page, you can use the content you add to the content files with the localize filter, i.e. `{{ .hero.cta_text | localize }}`. Review the [Page Content](#page-content) section below for more detail
1. Pages are written using the Nunjucks templating language, review the [Nunjucks documentation](https://mozilla.github.io/nunjucks/) to see all the options available to you

### Page Frontmatter Requirements

You'll need to add a few properties in `yml` format to the markdown frontmatter at the very top of your file. Here's an example:

```
---
route:
    en: /en/example-url-for/english-translation
    es: /es/url-ejemplo-para/traduccion-en-espanol
name: example.correlates.toAContentFile
---
```

The `route` property creates the URL for each translated site.

### Page Content

All page content is added to the [content](content) directory.

The page `name` property should correlate to the content path. For example `name: about.stacSpec` correlates to the [content/about/stac-spec.js](content/about/stac-spec.js) file. This works because the file is exported from the file and imported into the [content/about/index.js](content/about/index.js) file, which is then imported into the larger content object at [content/index.js](content/index.js).

To reference the content from the correlated content file in the template files, you can use the filter `localize`, like so:

```
{{ .hero.cta_text | localize }}
```

with the first `.` in `.hero` referencing that the content should be scoped to that correlated file, rather than the content root.

All content is saved in a format that the [Eleventy i18n plugin](https://www.npmjs.com/package/eleventy-plugin-i18n) recommends. The final property in the tree should correlate to a locale code, for example:

```
hero: {
    cta_text: {
        'en': 'Click',
        'es': 'Hacer clic'
    }
}
```

If in the future, it becomes too cumbersome to manage content in the filesystem, eleventy can generate content from API calls as well. An example of this can be found in [app/_data/catalogs.js](app/_data/catalogs.js)

## Translations

If you want to translate the site into another language, here are all the steps you'll need to take:

### #1 Translate all content

In the content files (everything in the `content` folder), anywhere you see an `en:` means it is the english version. Add your translation with the locale code right next to that, i.e:

```
hero: {
    cta_text: {
        'en': 'Click',
        'es': 'Hacer clic'
    }
}
```

### #2 Translate tutorials

In the tutorials folder, anything with the extension `en.md` is a tutorial in english. Copy this file in the same folder and add the locale in place of `en`. You can also translate the filename to give the tutorial a translated url for example `hello.en.md` would be copied as `hola.es.md` in the same folder. The url for that would be `stacspec.org/es/tutorials/hola`.

### #3 Activate your translated site

In the file `app/_data/locales.js`, add your locale to the list. Right now the entire contents of that file are:

```
module.exports = ['en'];
```

To add spanish, you would update that to be:

```
module.exports = ['en', 'es'];
```

## Deployment & CI (future)

The site deploys automatically from the master branch using [Netlify](https://www.netlify.com/).

When opening a pull request, Netlify will generate a [preview environment](https://docs.netlify.com/site-deploys/deploy-previews/).

Automated checks run before each deploy using GitHub Actions.

## Architecture

- [Node.js](https://nodejs.org/en/) is the base technology that the site is built on
- Site uses the [11ty static site generator](https://www.11ty.dev/) to compile all the site files into a static website build.
- Templating is in the [Nunjucks templating language](https://mozilla.github.io/nunjucks/)
- [Docker](https://www.docker.com/products/docker-desktop/) is used to build notebooks
- [Tailwind CSS](https://tailwindcss.com/docs/overflow) is used to reduce the amount of custom css without compromising custom look and feel
- [Alpine JS](https://alpinejs.dev/) is used to create interactive components

## Data

Most of the site data is pulled into the [11ty data cascade](https://www.11ty.dev/docs/data-cascade/) and available in template files, either as collections (i.e. [app/tutorials](app/tutorials)) or as global data (i.e. [app/_data/catalogs.js]([app/_data/catalogs.js]).

These are the data types in brief, with links to readme locations where more info is available:
- [pages](#pages): Created by 11ty based on the files in [app/pages](app/pages)
- [tutorials](#creating-tutorials): Added to [app/tutorials](app/tutorials) directory as markdown files
- [categories](#creating-tutorials): Autogenerated by tutorial directory structure
- [routes](#page-frontmatter-requirements): Created from route frontmatter in the page template files
- [content](#page-content): One big javascript object, passed into global data and accessible via the `localize` filter

## Images

Images are compressed and resized using the [Eleventy Image plugin](https://www.11ty.dev/docs/plugins/image/).

You can add an image to the [assets/images](assets/images) direcory, and include it in your template files via the `image` shortcode with a `filename`, `alt text` and `size`. For example:

```
{% image 'assets/images/STAC-01.png', 'stac logo', '300px' %}
```

You can also add different sizes for different breakpoints by updating the last parameter, like so:

```
{% image 'assets/images/STAC-01.png', 'stac logo', '(min-width: 1000px) 800px, 400px' %}
```
